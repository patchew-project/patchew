{% extends 'base.html' %}

{% block header %}
<link rel="stylesheet" href="/static/css/series-detail.css">
<link rel="stylesheet" href="/static/highlight/default.css">
<script src="/static/highlight/highlight.pack.js"></script>
<link rel="stylesheet" href="/static/css/colorbox.css">
<script src="/static/js/jquery.colorbox-min.js"></script>
{% endblock %}

{% block content %}

<div class="series-detail" id="top"></div>

<div class="col-lg-12">
<h2>{{ series.subject }}</h2>
<div class="series-header-info">
            <span class="message-author" title="{{ series.sender_full_name }}">
                {{ series.sender_display_name }}
	    </span> posted <span class="patch-count">
		    {{ series.total_patches }}
		    patch{% if series.total_patches != 1 %}es{% endif %}
	    </span> <span class="message-age" title="{{ series.date }}">
		    {{ series.age }} ago</span>
</div>

<div class="status">
{% if series.num_patches < series.total_patches %}
<div class="status-content status-alert">
   <span class="fa fa-lg fa-warning"></span>
   <div>Only {{ series.num_patches }} patches received!</div>
</div>
{% endif %}
{% for status in series.extra_status %}
 <div class="status-content{% if status.kind %} status-{{ status.kind }}{% endif %}">
 {% if status.icon %}<span class="fa fa-lg fa-{{ status.icon }}"></span>
 {% elif status.kind == "running" %} <span class="fa fa-lg fa-refresh fa-spin"></span>
 {% elif status.kind == "alert" %} <span class="fa fa-lg fa-warning"></span>
 {% elif status.kind == "good" %} <span class="fa fa-lg fa-check"></span>{% endif %}
 <div>{{ status.html }}</div>
 {% if status.extra %}
  <div class="status-extra" id="{{status.id}}">{{ status.extra }}</div>
 {% endif %}
</div>
{% endfor %}
</div>
</div>

<div id="pre-fixed"></div>
<div class="col-lg-2">
    <div id="fixed" class="list-group">
        <a href="#" class="list-group-item" id="btn-expand-all">Expand all</a>
        <a href="#" class="list-group-item" id="btn-fold-all">Fold all</a>
        {% for op in series.extra_ops %}
            <a href="{{ op.url }}"
                class="list-group-item list-group-item-{% if op.class %}{{ op.class }}{% else %}info{% endif %}">
                {{ op.title }}
            </a>
        {% endfor %}
        <a href="/{{ project }}/{{ series.message_id }}/mbox" class="list-group-item list-group-item-info">Download mbox</a>
    </div>
</div>
<div class="col-lg-10">
    {% if series.get_diff_stat %}
    <div class="panel panel-default">
        <div class="panel-heading panel-toggler" onclick="patchew_toggler_onclick(this)">
        Changeset
        </div>
        <div class="panel-body panel-toggle">
            <pre class="body-full">{{ series.get_diff_stat }}</pre>
        </div>
    </div>
    {% endif %}

    <div id="thread">
    {% for msg in messages %}
        <div class="panel panel-default message reply-lvl-{{ msg.indent_level }}">
            <div class="panel-heading panel-toggler" onclick="patchew_toggler_onclick(this)">
                    <h3 class="panel-title">
                        {{ msg.subject }}
                    </h3>

                    <div class="message-info">
                        Posted by
                        <span class="message-author" title="{{ msg.sender_full_name }}">
                            {{ msg.sender_display_name }}</span>
                        <span class="message-age" title="{{ msg.date }}">
                            {{ msg.get_age }}
                        </span>
                        ago
                    </div>
            </div>
            <div class="panel-body panel-toggle panel-hidden">
                {% if msg.is_patch %}
                <pre class="body-full"><code class="diff">{{ msg.get_body }}</code></pre>
                {% else %}
                <pre class="body-full">{{ msg.get_body }}</pre>
                {% endif %}
            </div>
        </div>
    {% endfor %}
    </div>
</div>

<script type="text/javascript">

function main() {
    $(".timestamp").each(function (i, o) {
        $(o).attr("title", new Date(1000 * $(o).attr("title")));
    });
    $("#btn-expand-all").click(function () {
        $(".panel-toggle").show();
    });
    $("#btn-fold-all").click(function () {
        $(".panel-toggle").hide();
    });
    $(document).ready(function() {
        $('pre code').each(function(i, block) {
            hljs.highlightBlock(block);
        });
        $(".cbox-inline").colorbox({inline:true, width:"90%", className:'colorbox-pre'})
        $(".cbox-log").colorbox({width:"90%", className:'colorbox-pre'})
    });
    add_fixed_scroll_events();
}

$(main);

</script>

{% endblock %}
